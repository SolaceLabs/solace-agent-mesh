# DEVELOPER GUIDE: dto

## Quick Summary
The `dto` directory contains Data Transfer Objects (DTOs) for API contract definition and validation in the HTTP SSE gateway. It's organized into two main subdirectories: `requests` for incoming API request validation using Pydantic models, and `responses` for structured API response formatting with automatic timestamp conversion. The DTOs primarily focus on session management operations and provide type-safe interfaces for API endpoints.

## Files and Subdirectories Overview
- **Direct files:** 
  - `__init__.py` - Main module exports for requests and responses submodules
- **Subdirectories:**
  - `requests/` - Request DTOs for API endpoint validation (session CRUD operations)
  - `responses/` - Response DTOs with automatic timestamp serialization and field aliasing

## Developer API Reference

### Direct Files

#### __init__.py
**Purpose:** Main entry point that exports the requests and responses submodules
**Import:** `from solace_agent_mesh.gateway.http_sse.routers.dto import requests, responses`

**Exports:**
- `requests` - Module containing all request DTOs
- `responses` - Module containing all response DTOs

### Subdirectory APIs

#### requests/
**Purpose:** Provides Pydantic models for validating incoming API requests, specifically for session management operations
**Key Exports:** GetSessionsRequest, GetSessionRequest, GetSessionHistoryRequest, UpdateSessionRequest, DeleteSessionRequest
**Import Examples:**
```python
from solace_agent_mesh.gateway.http_sse.routers.dto.requests import (
    GetSessionsRequest,
    GetSessionRequest,
    GetSessionHistoryRequest,
    UpdateSessionRequest,
    DeleteSessionRequest
)
```

#### responses/
**Purpose:** Provides structured response DTOs with automatic timestamp conversion and field aliasing for API consistency
**Key Exports:** MessageResponse, SessionResponse, SessionListResponse, BaseTimestampResponse
**Import Examples:**
```python
from solace_agent_mesh.gateway.http_sse.routers.dto.responses import (
    MessageResponse,
    SessionResponse,
    SessionListResponse
)
```

## Complete Usage Guide

### 1. Basic Imports and Setup

```python
# Import the main dto modules
from solace_agent_mesh.gateway.http_sse.routers.dto import requests, responses

# Or import specific DTOs directly
from solace_agent_mesh.gateway.http_sse.routers.dto.requests import (
    GetSessionsRequest,
    UpdateSessionRequest,
    DeleteSessionRequest
)
from solace_agent_mesh.gateway.http_sse.routers.dto.responses import (
    SessionResponse,
    MessageResponse,
    SessionListResponse
)
```

### 2. Working with Request DTOs

```python
from solace_agent_mesh.gateway.http_sse.routers.dto.requests import (
    GetSessionsRequest,
    GetSessionRequest,
    UpdateSessionRequest,
    DeleteSessionRequest
)
from pydantic import ValidationError

# Create a paginated request for getting sessions
def get_user_sessions(user_id: str, page: int = 1, page_size: int = 10):
    try:
        request = GetSessionsRequest(
            user_id=user_id,
            pagination={"page": page, "size": page_size},
            sort={"field": "created_at", "direction": "desc"},
            filters=[{"field": "status", "operator": "eq", "value": "active"}]
        )
        return request
    except ValidationError as e:
        print(f"Invalid request parameters: {e}")
        return None

# Create a request to update session name
def update_session_name(session_id: str, user_id: str, new_name: str):
    try:
        request = UpdateSessionRequest(
            session_id=session_id,
            user_id=user_id,
            name=new_name  # Automatically validated (1-255 characters)
        )
        return request
    except ValidationError as e:
        print(f"Validation failed: {e}")
        return None

# Create a request to delete a session
def delete_session(session_id: str, user_id: str):
    return DeleteSessionRequest(
        session_id=session_id,
        user_id=user_id
    )
```

### 3. Working with Response DTOs

```python
from solace_agent_mesh.gateway.http_sse.routers.dto.responses import (
    SessionResponse,
    MessageResponse,
    SessionListResponse
)
from solace_agent_mesh.gateway.http_sse.shared.enums import MessageType, SenderType
import time

# Create session responses
def create_session_response(session_data: dict) -> SessionResponse:
    return SessionResponse(
        id=session_data["id"],
        user_id=session_data["user_id"],
        name=session_data.get("name"),
        agent_id=session_data.get("agent_id"),
        created_time=int(time.time() * 1000),  # Current time in epoch ms
        updated_time=session_data.get("updated_time")
    )

# Create message responses
def create_message_response(message_data: dict) -> MessageResponse:
    return MessageResponse(
        id=message_data["id"],
        session_id=message_data["session_id"],
        message=message_data["message"],
        sender_type=SenderType.USER,
        sender_name=message_data["sender_name"],
        message_type=MessageType.TEXT,
        created_time=int(time.time() * 1000)
    )

# Create paginated session list responses
def create_session_list_response(sessions: list, total: int) -> SessionListResponse:
    session_responses = [create_session_response(session) for session in sessions]
    return SessionListResponse(
        sessions=session_responses,
        pagination={"page": 1, "size": len(sessions), "total_pages": 1},
        total_count=total
    )
```

### 4. Complete API Endpoint Example

```python
from fastapi import APIRouter, HTTPException
from solace_agent_mesh.gateway.http_sse.routers.dto.requests import (
    GetSessionsRequest,
    UpdateSessionRequest
)
from solace_agent_mesh.gateway.http_sse.routers.dto.responses import (
    SessionResponse,
    SessionListResponse
)

router = APIRouter()

@router.get("/sessions")
async def get_sessions(
    user_id: str,
    page: int = 1,
    size: int = 10
) -> SessionListResponse:
    """Get user sessions with pagination"""
    
    # Create and validate request DTO
    request = GetSessionsRequest(
        user_id=user_id,
        pagination={"page": page, "size": size}
    )
    
    # Fetch data (mock implementation)
    sessions_data = fetch_user_sessions(request)
    
    # Create response DTOs
    session_responses = [
        SessionResponse(
            id=session["id"],
            user_id=session["user_id"],
            name=session["name"],
            created_time=session["created_time"]
        )
        for session in sessions_data["sessions"]
    ]
    
    # Return structured response with automatic timestamp conversion
    return SessionListResponse(
        sessions=session_responses,
        total_count=sessions_data["total"]
    )

@router.put("/sessions/{session_id}")
async def update_session(
    session_id: str,
    user_id: str,
    name: str
) -> SessionResponse:
    """Update session name"""
    
    # Validate request using DTO
    try:
        request = UpdateSessionRequest(
            session_id=session_id,
            user_id=user_id,
            name=name
        )
    except ValidationError as e:
        raise HTTPException(status_code=400, detail=str(e))
    
    # Update session (mock implementation)
    updated_session = update_session_in_db(request)
    
    # Return response DTO with automatic field aliasing
    return SessionResponse(
        id=updated_session["id"],
        user_id=updated_session["user_id"],
        name=updated_session["name"],
        created_time=updated_session["created_time"],
        updated_time=updated_session["updated_time"]
    )
```

### 5. JSON Serialization with Automatic Timestamp Conversion

```python
from solace_agent_mesh.gateway.http_sse.routers.dto.responses import SessionResponse
import json

# Create a session response
session = SessionResponse(
    id="sess_123",
    user_id="user_456",
    name="My Session",
    created_time=1640995200000,  # Epoch milliseconds
    updated_time=1640995260000
)

# Automatic conversion to ISO strings in JSON output
json_output = session.model_dump_json()
print(json_output)
# Output: {
#   "id": "sess_123",
#   "userId": "user_456",  # Note the camelCase aliasing
#   "name": "My Session",
#   "createdTime": "2022-01-01T00:00:00Z",  # Converted to ISO string
#   "updatedTime": "2022-01-01T00:01:00Z"
# }

# Get dict with converted timestamps
dict_output = session.model_dump()
print(dict_output["createdTime"])  # "2022-01-01T00:00:00Z"
```

This comprehensive guide shows how the `dto` directory provides a complete type-safe API contract system with automatic validation for requests and structured responses with timestamp conversion for the HTTP SSE gateway.

# content_hash: 530e6b99d1e0adcdc9c75118a3c9249ca6a5e0dda321a6087121acff1fe9f7e4
