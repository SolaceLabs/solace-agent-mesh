# nsjail configuration for SAM sandbox worker - Permissive profile
# This profile provides minimal sandboxing with more capabilities.
# Use for trusted tools that need more access.

name: "sam-tool-permissive"

# Execute once and exit
mode: ONCE

# Hostname inside the sandbox
hostname: "sandbox"

# Working directory
cwd: "/sandbox/work"

# Time limit in seconds (generous)
time_limit: 600

# Resource limits (generous)
rlimit_as: 4096          # 4GB virtual memory
rlimit_core: 0           # No core dumps
rlimit_cpu: 600          # 10 min CPU time
rlimit_fsize: 1024       # 1GB max file size
rlimit_nofile: 1024      # 1024 open files

# CPU affinity (up to 4 CPUs)
max_cpus: 4

# Keep all environment variables
keep_env: true

# Mount configuration - extensive
mount {
    src: "/proc"
    dst: "/proc"
    is_bind: true
}

mount {
    dst: "/dev"
    fstype: "tmpfs"
    rw: true
}

mount {
    src: "/dev/null"
    dst: "/dev/null"
    is_bind: true
    rw: true
}

mount {
    src: "/dev/zero"
    dst: "/dev/zero"
    is_bind: true
}

mount {
    src: "/dev/urandom"
    dst: "/dev/urandom"
    is_bind: true
}

# Mount all system directories
mount {
    src: "/lib"
    dst: "/lib"
    is_bind: true
}

mount {
    src: "/usr"
    dst: "/usr"
    is_bind: true
}

mount {
    src: "/etc"
    dst: "/etc"
    is_bind: true
}

# Large temporary directory
mount {
    dst: "/tmp"
    fstype: "tmpfs"
    rw: true
}

# Mount /var for logs and runtime
mount {
    dst: "/var"
    fstype: "tmpfs"
    rw: true
}

# Mount sandbox work directory
mount {
    src: "/sandbox/work"
    dst: "/sandbox/work"
    is_bind: true
    rw: true
}
