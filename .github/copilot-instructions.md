# Solace Agent Mesh Development Guide

**Always reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.**

## Working Effectively

### Bootstrap and Setup
- **Install Python 3.10.16+ and hatch**:
  ```bash
  python3 -m pip install hatch
  ```
- **Create development environment**: 
  ```bash
  hatch env create
  ```
  - **TIMING**: 10-15 minutes on first run. NEVER CANCEL. Set timeout to 30+ minutes.
  - **NOTE**: May fail due to network timeouts - if this happens, the project can still be worked on using direct pip installs for specific dependencies.

### Alternative Setup (if hatch fails)
- **Install basic dependencies manually**:
  ```bash
  pip install --user flask flask_cors click rich pydantic PyYAML pytest
  ```
- **Set Python path when running CLI**:
  ```bash
  export PYTHONPATH=cli:src:tests/sam-test-infrastructure/src
  ```

### Frontend Development Setup
- **Install Node.js dependencies**:
  ```bash
  cd client/webui/frontend
  npm install
  ```
  - **TIMING**: ~15 seconds. Set timeout to 2+ minutes.
- **Build frontend**:
  ```bash
  npm run build
  ```
  - **TIMING**: ~10 seconds. Set timeout to 2+ minutes.
- **Build frontend as reusable library**:
  ```bash
  npm run build-package  
  ```
  - **TIMING**: ~8 seconds. Set timeout to 2+ minutes.

### Testing
- **Frontend linting**:
  ```bash
  cd client/webui/frontend
  npm run lint
  ```
  - **TIMING**: ~5 seconds. Set timeout to 1+ minute.
- **Python unit tests**:
  ```bash
  PYTHONPATH=cli:src:tests/sam-test-infrastructure/src python3 -m pytest tests/unit -v
  ```
  - **NOTE**: Requires pytest-asyncio and many dependencies. Use hatch environment when possible.
- **Integration tests**:
  ```bash
  hatch run test
  ```
  - **TIMING**: Long-running tests exist (stress tests can take hours). NEVER CANCEL. Set timeout to 180+ minutes for full test suite.

### Running the Application
- **CLI tool** (when dependencies available):
  ```bash
  # With hatch environment
  hatch shell
  sam --help
  
  # Or directly (requires PYTHONPATH)
  PYTHONPATH=cli:src python3 cli/main.py --help
  ```
- **Initialize new project**:
  ```bash
  sam init --gui  # Runs on port 5002
  ```
- **Run project**:
  ```bash
  sam run  # Web UI available at http://localhost:8000
  ```
- **Add agent with GUI**:
  ```bash
  sam add agent --gui
  ```

## Validation

### Always Validate Changes
- **Run frontend linting before commits**:
  ```bash
  cd client/webui/frontend && npm run lint
  ```
- **Run pre-commit hooks**: The `.hooks/pre-commit` script runs `npm run precommit` for frontend changes
- **Test CLI functionality**: Always test `sam --help` and basic commands after making CLI changes
- **Frontend development server**: Use `npm run dev` in `client/webui/frontend/` for UI changes

### Manual Testing Scenarios
- **CLI Workflow**: Test `sam init --skip`, create agent configs, validate YAML generation
- **Frontend Build**: Ensure both `npm run build` and `npm run build-package` work without errors
- **Integration**: When possible, test that the frontend can communicate with backend services

## Key Architecture Components

### Core Framework (Python)
- **Main package**: `src/solace_agent_mesh/` - Core framework code
- **CLI**: `cli/` - Command-line interface and utilities  
- **Configuration**: Uses YAML configs in `configs/` directories generated by CLI
- **Build system**: hatch (pyproject.toml) with custom build hooks for frontend assets

### Frontend (React TypeScript)
- **Location**: `client/webui/frontend/`
- **Build system**: Vite + TypeScript
- **Package**: Can be built as both standalone app and reusable library
- **Key scripts**: `dev`, `build`, `build-package`, `lint`, `precommit`

### Testing Infrastructure
- **Unit tests**: `tests/unit/` - Focus on CLI and core functionality
- **Integration tests**: `tests/integration/` - Full system testing with test infrastructure
- **Test infrastructure**: `tests/sam-test-infrastructure/` - Shared testing utilities
- **Long-running tests**: Marked with `@pytest.mark.long_soak` - can take hours

### Documentation and Examples
- **Documentation**: `docs/` - Built documentation system
- **Examples**: `examples/` - Sample configurations and use cases
- **Templates**: `templates/` - Code generation templates used by CLI

## Common Development Patterns

### File Organization
- **Agent configs**: Generated in `configs/agents/*.yaml` 
- **Component configs**: Generated in `configs/components/*.yaml`
- **Templates**: Located in `templates/` for code generation
- **Static assets**: Frontend builds output to `client/webui/frontend/static/`

### CLI Development
- **Commands**: Organized in `cli/commands/` by functionality
- **Utils**: Shared utilities in `cli/utils.py`
- **Testing**: Unit tests in `tests/unit/cli/` test configuration generation

### Frontend Development  
- **Components**: React components in `src/` with TypeScript
- **Styling**: Tailwind CSS with custom configuration
- **Build outputs**: Dual builds - full app and library package
- **Library exports**: Configured in `vite.lib.config.ts` for reusable components

## Important Constraints

### Network Dependencies
- **PyPI timeouts**: Network connectivity to PyPI may be limited - document when pip installs fail
- **NPM registry**: Frontend dependencies install reliably
- **Hatch environment**: May fail on first setup due to network issues

### Build Time Expectations
- **Frontend builds**: Fast (~10 seconds) 
- **Python environment**: Slow initial setup (10-15+ minutes) - NEVER CANCEL
- **Full test suite**: Very long (can take hours for stress tests) - NEVER CANCEL
- **Integration tests**: Require complex infrastructure setup

### Development Workflow
- **Always validate**: Run lints and builds after changes
- **Frontend changes**: Trigger pre-commit hook automatically
- **CLI changes**: Test basic functionality with `sam --help`  
- **Configuration changes**: Validate YAML generation with CLI commands

## Repository-Specific Commands

### Quick Status Check
```bash
# Check repo structure
ls -la  # Should see: cli/, src/, client/, tests/, docs/, pyproject.toml

# Test basic CLI (may need dependencies)
PYTHONPATH=cli:src python3 cli/main.py --version

# Test frontend
cd client/webui/frontend && npm run lint
```

### Common File Paths
- **Main CLI entry**: `cli/main.py`
- **Core framework**: `src/solace_agent_mesh/`
- **Frontend app**: `client/webui/frontend/src/`
- **Unit tests**: `tests/unit/`
- **Integration tests**: `tests/integration/`  
- **Build config**: `pyproject.toml`, `client/webui/frontend/package.json`
- **CI workflows**: `.github/workflows/ci.yaml`, `.github/workflows/ui-ci.yml`