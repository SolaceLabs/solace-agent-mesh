name: Push Docker Image (Manual Dispatch)

on:
  workflow_dispatch:
    inputs:
      branch-to-checkout:
        description: "The branch to checkout"
        required: true
        type: string
      version:
        description: "The version tag for the Docker image (e.g., 1.0.0). If not provided, it will attempt to use the latest git tag."
        required: false
        type: string
      push_latest:
        description: 'Whether to also tag and push as "latest"'
        required: false
        type: boolean
        default: false

permissions:
  contents: read

jobs:
  build_and_push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          fetch-tags: true
          ref: ${{ github.event.inputs.branch-to-checkout }}

      - name: Push Docker Image
        uses: ./.github/actions/push-docker
        with:
          version_tag: ${{ github.event.inputs.version }}
          push_latest: ${{ github.event.inputs.push_latest }}
          docker_username: ${{ secrets.DOCKER_USERNAME }}
          docker_password: ${{ secrets.DOCKER_PASSWORD }}
