# Sandbox Test Agent Example
#
# This agent configuration demonstrates using SAM remote tools.
# The tools are executed on a remote sandbox worker via topic-based routing.
# The agent only specifies tool_name - the worker resolves implementation
# from its tool manifest.
#
# To test locally:
#   1. Start SAM with this config + orchestrator + webui
#   2. Start the sandbox worker container (with tools/manifest.yaml mounted)
#   3. Use the web UI to interact with the agent
#
# Requirements:
#   - Sandbox worker must be running with matching tool manifest
#   - dev_broker_network_enabled must be true for local testing

log:
  stdout_log_level: INFO
  log_file_level: DEBUG
  log_file: sandbox_test_agent.log

!include ../shared_config.yaml

apps:
  - name: sandbox_test_agent_app
    app_base_path: .
    app_module: solace_agent_mesh.agent.sac.app
    broker:
      <<: *broker_connection
      # Enable network server for sandbox worker container
      dev_broker_network_enabled: ${DEV_BROKER_NETWORK_ENABLED, true}
      dev_broker_network_port: ${DEV_BROKER_PORT, 55554}

    app_config:
      namespace: ${NAMESPACE}
      supports_streaming: true
      agent_name: "SandboxTestAgent"
      display_name: "Sandbox Test"
      model: *planning_model

      instruction: |
        You are an agent that can execute Python code in a secure sandbox environment.
        You have access to tools that run in an isolated container via bubblewrap (bwrap).

        When asked to run code, write data analysis, or perform computations, use
        the execute_python tool. You can write full Python programs including imports
        from the standard library.

        To return a value from your code, assign it to a variable called `result`.
        Anything printed to stdout is also captured.

        To create file artifacts, use `save_artifact(filename, content_bytes)`.
        To send progress updates, use `send_status(message)`.

        If artifacts are provided, their file paths are available in the
        `artifact_files` dict keyed by parameter name.

      # Tools configuration - mix of builtin and remote tools
      tools:
        # Standard builtin tools
        - tool_type: builtin
          tool_name: "time_delay"

        # Artifact management for working with files
        - tool_type: builtin-group
          group_name: "artifact_management"

        # Remote echo tool - routed to worker via topic
        - tool_type: sam_remote
          tool_name: "echo_tool"
          tool_description: "Echo back a message from the secure sandbox environment. Use this to test sandbox execution."
          timeout_seconds: 30
          parameters:
            message:
              type: string
              description: "The message to echo back"

        # Remote Python code execution - routed to worker via topic
        - tool_type: sam_remote
          tool_name: "execute_python"
          tool_description: "Execute arbitrary Python code in a secure sandbox. Assign to `result` to return a value. Use `print()` for stdout. Use `save_artifact(filename, bytes)` to create files. Use `send_status(msg)` for progress. Artifact file paths are in `artifact_files` dict."
          timeout_seconds: 60
          parameters:
            code:
              type: string
              description: "Python source code to execute"
            artifacts:
              type: array
              description: "Optional list of artifact parameter names whose files should be available"
              required: false

        # Remote file processing - tests artifact input/output pipeline
        - tool_type: sam_remote
          tool_name: "process_file"
          tool_description: "Process an input file artifact. Computes word/line/character counts and creates a summary artifact."
          timeout_seconds: 30
          parameters:
            input_file:
              type: artifact
              description: "The input file to process"

      session_service:
        type: "memory"
        default_behavior: "PERSISTENT"

      artifact_service:
        type: "filesystem"
        base_path: "/tmp/samv2"
        artifact_scope: namespace

      artifact_handling_mode: "reference"
      enable_embed_resolution: true
      enable_artifact_content_instruction: true

      agent_card:
        description: |
          Test agent for sandboxed tool execution. This agent can run tools
          in an isolated container environment for security testing.
        defaultInputModes: ["text"]
        defaultOutputModes: ["text", "file"]
        skills:
          - id: sandbox_test
            name: Sandbox Test
            description: "Test sandboxed tool execution"
            examples:
              - "Run a sandboxed tool to process some data"
              - "Execute a secure computation"

      agent_card_publishing: { interval_seconds: 10 }
      agent_discovery: { enabled: true }
      inter_agent_communication:
        allow_list: ["*"]
        request_timeout_seconds: 120
