# Lambda Streaming Executor Example Agent
#
# This example demonstrates streaming status updates from a Lambda function,
# along with artifact input and output support.
#
# Prerequisites:
#   1. Run ./setup-streaming-lambda.sh to create the Lambda function
#   2. Set the SAM_LAMBDA_STREAMING_URL environment variable (printed by setup script)
#   3. Ensure AWS credentials are available (AWS_PROFILE=default in .env)
#
# Usage:
#   sam run examples/agents/lambda-executor-streaming/lambda_streaming_example.yaml
#
# Test prompts:
#   - "Analyze the document sample.txt" (after uploading a text file)
#   - "Can you analyze this text file for me?"

log:
  stdout_log_level: INFO
  log_file_level: DEBUG
  log_file: lambda_streaming_agent.log

!include ../../shared_config.yaml

apps:
  - name: lambda_streaming_agent_app
    app_base_path: .
    app_module: src.solace_agent_mesh.agent.sac.app
    broker:
      <<: *broker_connection

    app_config:
      namespace: ${NAMESPACE}
      supports_streaming: true
      agent_name: "LambdaStreamingAgent"
      display_name: "Lambda Document Analyzer"
      model: *planning_model

      instruction: |
        You are a document analysis agent that can analyze text documents with
        real-time progress updates. You have access to the analyze_document tool
        which performs comprehensive text analysis including:

        - Word count and character statistics
        - Vocabulary analysis (unique words, richness)
        - Frequency analysis (most common words)
        - Readability metrics (sentence length, reading time)

        When a user uploads a text document or asks you to analyze one, use the
        analyze_document tool. The analysis takes a few seconds and you'll see
        real-time status updates as it progresses through each analysis step.

        The tool will return both a summary and a detailed analysis report as
        an artifact that the user can download.

      tools:
        # Document analysis tool - demonstrates streaming with artifact I/O
        - tool_type: executor
          name: "analyze_document"
          description: |
            Analyze a text document with streaming progress updates. Performs
            comprehensive analysis including word count, vocabulary analysis,
            word frequency, and readability metrics. Takes a few seconds to
            complete and streams status updates during processing.
            Returns an analysis report artifact.
          executor: lambda
          function_url: ${SAM_LAMBDA_STREAMING_URL}
          include_context: true
          timeout_seconds: 120
          parameters:
            properties:
              document:
                type: artifact
                description: The text document to analyze
            required:
              - document

        # Add artifact management tools so users can upload/view files
        - tool_type: builtin-group
          group_name: "artifact_management"

      session_service:
        type: "memory"
        default_behavior: "PERSISTENT"

      artifact_service:
        type: "filesystem"
        base_path: "/tmp/samv2"
        artifact_scope: namespace

      artifact_handling_mode: "reference"
      enable_embed_resolution: true
      enable_artifact_content_instruction: true

      agent_card:
        description: |
          A document analysis agent that processes text files with real-time
          streaming progress updates. Upload a text document and ask for analysis
          to see detailed statistics about word count, vocabulary, word frequency,
          and readability metrics.
        defaultInputModes: ["text", "file"]
        defaultOutputModes: ["text", "file"]
        skills:
          - id: analyze_document
            name: Document Analysis
            description: "Analyze text documents with streaming progress updates"
            examples:
              - "Analyze the document sample.txt"
              - "Can you analyze this text file and give me statistics?"
              - "What are the most common words in my document?"

      agent_card_publishing: { interval_seconds: 10 }
      agent_discovery: { enabled: true }
      inter_agent_communication:
        allow_list: ["*"]
        request_timeout_seconds: 120
