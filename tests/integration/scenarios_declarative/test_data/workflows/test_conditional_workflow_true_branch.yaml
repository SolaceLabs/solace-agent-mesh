test_case_id: "conditional_workflow_true_branch_001"
description: "Tests a conditional workflow where the true branch is taken based on success status"
tags: ["all", "workflows", "conditional"]
skip_intermediate_events: true
expected_completion_timeout_seconds: 30

test_runner_config_overrides:
  agent_config:
    artifact_scope: "namespace"

setup_artifacts:
  - filename: "workflow_input.json"
    content: '{"input_text": "Test conditional", "should_succeed": true}'
    mime_type: "application/json"

gateway_input:
  target_agent_name: "ConditionalTestWorkflow"
  user_identity: "workflow_test_user@example.com"
  external_context:
    a2a_session_id: "conditional_test_session"
  prompt:
    parts:
      - text: "Run the conditional workflow"
  invoked_with_artifacts:
    - filename: "workflow_input.json"
      version: 0

llm_interactions:
  # Step 1: TestPeerAgentA (check_status) - returns success status
  - static_response:
      choices:
        - message:
            role: "assistant"
            content: |
              «««save_artifact: filename="check_status_output.json" mime_type="application/json" description="Status check result"
              {"status": "success", "message": "All checks passed"}
              »»»
    expected_request:
      tools_present: ["load_artifact"]

  # Step 2: System processes the artifact save notification
  - static_response:
      choices:
        - message:
            role: "assistant"
            content: "Status check complete. «result:artifact=check_status_output.json:0 status=success»"
    expected_request:
      expected_tool_responses_in_llm_messages:
        - tool_name: "_notify_artifact_save"
          response_json_matches:
            filename: "check_status_output.json"
            status: "success"

  # Step 3: TestPeerAgentB (success_path) - handles success
  # Note: failure_path is skipped because condition was true
  - static_response:
      choices:
        - message:
            role: "assistant"
            content: |
              «««save_artifact: filename="success_output.json" mime_type="application/json" description="Success path result"
              {"result": "Successfully processed", "path": "success"}
              »»»
    expected_request:
      tools_present: ["load_artifact"]

  # Step 4: System processes the artifact save for success path
  - static_response:
      choices:
        - message:
            role: "assistant"
            content: "Success path complete. «result:artifact=success_output.json:0 status=success»"
    expected_request:
      expected_tool_responses_in_llm_messages:
        - tool_name: "_notify_artifact_save"
          response_json_matches:
            filename: "success_output.json"
            status: "success"

expected_gateway_output:
  - type: "final_response"
    task_state: "completed"
