test_case_id: "artifact_by_reference_success_001"
description: "Tests that a referenced file (FileWithUri) is correctly processed by the agent. Note: With PR #1106, LLM return limits increased from 4KB to 32KB, which may affect internal LLM call patterns."
tags: ["all", "common", "artifact", "reference"]
skip_intermediate_events: true
pr_1106_note: "This test was updated to account for increased LLM return limits. The test framework now allows a ±50% tolerance in LLM call counts for artifact scenarios."

description: "Tests that a referenced file (FileWithUri) is correctly processed by the agent. Note: With PR #1106, LLM return limits increased from 4KB to 32KB, which may affect internal LLM call patterns."
tags: ["all", "common", "artifact", "reference"]
skip_intermediate_events: true
pr_1106_note: "This test was updated to account for increased LLM return limits. The test framework now allows a ±50% tolerance in LLM call counts for artifact scenarios."

  - filename: "user:company_profile.txt"
    content: "This is the company profile."
    mime_type: "text/plain"
    metadata:
      source: "test_setup"

gateway_input:
  target_agent_name: "TestAgent"
  user_identity: "uri_user@test.com"
  external_context:
    a2a_session_id: "ref_test_session_001"
  a2a_parts:
    - type: "text"
      text: "What is this file about?"
    - type: "file"
      uri: "artifact://TestAgent/uri_user@test.com/ref_test_session_001/user:company_profile.txt?version=0"

llm_interactions:
  - expected_request:
      prompt_contains_artifact_summary_for:
        - filename: "user:company_profile.txt"
          version: 0
    static_response:
      choices:
        - message:
            role: "assistant"
            content: "The file is a company profile."

expected_gateway_output:
  - type: "final_response"
    content_parts:
      - type: "text"
        text_contains: "The file is a company profile."
